<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Honeymoon ë‚ ì”¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      padding: 20px 16px 40px;
      line-height: 1.5;
      background: #f5f5f7;
      color: #222;
    }

    h1 {
      margin: 0 0 18px;
      font-size: 1.8rem;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 16px;
    }

    #weather-container {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* ë„ì‹œ ì¹´ë“œ */
    .city-box {
      border: 1px solid #e6e6e6;
      border-radius: 14px;
      padding: 16px 18px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      max-width: 420px;
      width: 100%;
    }

    .city-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    /* í•˜ë£¨ ì •ë³´ í•œ ì¤„ */
    .day-row {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }

    .icon {
      width: 36px;
      height: 36px;
      background: #f3f3f3;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .date-label {
      font-weight: 600;
      font-size: 0.96rem;
    }

    .weekday {
      color: #777;
      font-weight: 500;
      font-size: 0.92rem;
      margin-left: 2px;
    }

    .weather-desc {
      color: #444;
      font-size: 0.92rem;
      margin-left: 4px;
    }

    .temp-line {
      font-size: 0.9rem;
      margin-top: 2px;
    }

    .temp-min {
      color: #0066ff;  /* ìµœì € = íŒŒë€ìƒ‰ */
      font-weight: 600;
    }

    .temp-max {
      color: #ff3333;  /* ìµœê³  = ë¹¨ê°„ìƒ‰ */
      font-weight: 600;
    }

    .precip {
      font-size: 0.83rem;
      color: #666;
      margin-left: 4px;
    }

    .loading,
    .error {
      font-size: 0.9rem;
      color: #777;
      margin-top: 4px;
    }

    /* ì•„ì´í° ì‘ì€ í™”ë©´ ëŒ€ì‘ */
    @media (max-width: 430px) {
      body {
        padding: 16px 12px 32px;
      }
      .city-box {
        padding: 14px 14px;
        border-radius: 12px;
      }
      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>

<body>

  <h1>Honeymoon ë‚ ì”¨</h1>
  <div class="subtitle">2025ë…„ ì¼ì • Â· í˜„ì§€ ì‹œê°„ ê¸°ì¤€ ì¼ë³„ ì˜ˆë³´</div>

  <div id="weather-container">
    <!-- ë‚ ì§œ í˜•ì‹: YYYY-MM-DD,YYYY-MM-DD (ì¶œë°œì¼, ë„ì°©ì¼) -->

    <div class="city-box"
         data-city="Lisbon"
         data-lat="38.72"
         data-lon="-9.14"
         data-range="2025-11-23,2025-11-25">
      <div class="city-title">ğŸ‡µğŸ‡¹ Lisbon (11/23 ~ 11/25)</div>
      <div class="days"></div>
    </div>

    <div class="city-box"
         data-city="Porto"
         data-lat="41.15"
         data-lon="-8.63"
         data-range="2025-11-25,2025-11-28">
      <div class="city-title">ğŸ‡µğŸ‡¹ Porto (11/25 ~ 11/28)</div>
      <div class="days"></div>
    </div>

    <div class="city-box"
         data-city="Barcelona"
         data-lat="41.39"
         data-lon="2.17"
         data-range="2025-11-28,2025-12-01">
      <div class="city-title">ğŸ‡ªğŸ‡¸ Barcelona (11/28 ~ 12/01)</div>
      <div class="days"></div>
    </div>

    <div class="city-box"
         data-city="Seville"
         data-lat="37.39"
         data-lon="-5.98"
         data-range="2025-12-01,2025-12-03">
      <div class="city-title">ğŸ‡ªğŸ‡¸ Sevilla (12/01 ~ 12/03)</div>
      <div class="days"></div>
    </div>

    <div class="city-box"
         data-city="Madrid"
         data-lat="40.42"
         data-lon="-3.70"
         data-range="2025-12-03,2025-12-04">
      <div class="city-title">ğŸ‡ªğŸ‡¸ Madrid (12/03 ~ 12/04)</div>
      <div class="days"></div>
    </div>
  </div>

  <script>
    // 1) Open-Meteoì—ì„œ 16ì¼ì¹˜ ì¼ê°„ ì˜ˆë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ê° ë„ì‹œ í˜„ì§€ ì‹œê°„ ê¸°ì¤€)
    async function getDailyForecast(lat, lon) {
      const params = new URLSearchParams({
        latitude: lat,
        longitude: lon,
        timezone: "auto", // ë„ì‹œ í˜„ì§€ ì‹œê°„ ê¸°ì¤€
        forecast_days: "16",
        daily: [
          "weathercode",
          "temperature_2m_max",
          "temperature_2m_min",
          "precipitation_probability_max"
        ].join(",")
      });

      const url = `https://api.open-meteo.com/v1/forecast?${params.toString()}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("HTTP ì˜¤ë¥˜: " + res.status);
      return res.json();
    }

    // 2) ë‚ ì§œ ë¬¸ìì—´ ë„ìš°ë¯¸ (ë¡œì»¬ íƒ€ì„ì¡´ ê¸°ì¤€, í•˜ë£¨ì”© ë°€ë¦¬ëŠ” ë¬¸ì œ ë°©ì§€)
    function formatLocalDateString(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`; // "2025-11-23"
    }

    // "2025-11-23,2025-11-25" â†’ ["2025-11-23","2025-11-24","2025-11-25"]
    function getDateRangeArray(startStr, endStr) {
      const result = [];
      const start = new Date(startStr + "T00:00:00");
      const end = new Date(endStr + "T00:00:00");

      for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        result.push(formatLocalDateString(d));
      }
      return result;
    }

    // "MM/DD (ìš”ì¼)" ë¼ë²¨
    function formatDateParts(dateStr) {
      const d = new Date(dateStr + "T00:00:00");
      const month = d.getMonth() + 1;
      const day = d.getDate();
      const weekdayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
      const weekday = weekdayNames[d.getDay()];
      return { month, day, weekday };
    }

    // 3) weathercode â†’ ì´ëª¨ì§€ / í•œê¸€ ì„¤ëª…
    function weatherCodeToEmoji(code) {
      if (code === 0) return "â˜€ï¸";
      if (code === 1 || code === 2) return "ğŸŒ¤ï¸";
      if (code === 3) return "â˜ï¸";
      if (code === 45 || code === 48) return "ğŸŒ«ï¸";
      if (code >= 51 && code <= 67) return "ğŸŒ¦ï¸";
      if (code >= 71 && code <= 77) return "â„ï¸";
      if (code >= 80 && code <= 82) return "ğŸŒ§ï¸";
      if (code >= 85 && code <= 86) return "ğŸŒ¨ï¸";
      if (code >= 95 && code <= 99) return "â›ˆï¸";
      return "ğŸŒˆ";
    }

    function weatherCodeToKorean(code) {
      if (code === 0) return "ë§‘ìŒ";
      if (code === 1) return "ëŒ€ì²´ë¡œ ë§‘ìŒ";
      if (code === 2) return "ë¶€ë¶„ì ìœ¼ë¡œ íë¦¼";
      if (code === 3) return "íë¦¼";
      if (code === 45 || code === 48) return "ì•ˆê°œ";
      if (code === 51 || code === 53 || code === 55) return "ì´ìŠ¬ë¹„";
      if (code === 56 || code === 57) return "ì–´ëŠ” ì´ìŠ¬ë¹„";
      if (code === 61 || code === 63 || code === 65) return "ë¹„";
      if (code === 66 || code === 67) return "ì–´ëŠ” ë¹„";
      if (code === 71 || code === 73 || code === 75) return "ëˆˆ";
      if (code === 77) return "ì‹¸ë½ëˆˆ";
      if (code === 80 || code === 81 || code === 82) return "ì†Œë‚˜ê¸°";
      if (code === 85 || code === 86) return "ì†Œë‚˜ê¸° ëˆˆ";
      if (code === 95) return "ë‡Œìš°";
      if (code === 96 || code === 99) return "ë‡Œìš°(ìš°ë°• ë™ë°˜)";
      return "ë‚ ì”¨ ì •ë³´";
    }

    // 4) í•œ ë„ì‹œ ë°•ìŠ¤ ë Œë”ë§
    function renderCity(box, data) {
      const daysDiv = box.querySelector(".days");
      daysDiv.innerHTML = "";

      const [startStr, endStr] = box.dataset.range.split(",");
      const targetDates = getDateRangeArray(startStr, endStr);

      const times = data.daily.time; // ì´ë¯¸ ë„ì‹œ í˜„ì§€ ë‚ ì§œ ë¬¸ìì—´
      const maxTemps = data.daily.temperature_2m_max;
      const minTemps = data.daily.temperature_2m_min;
      const codes = data.daily.weathercode;
      const pops = data.daily.precipitation_probability_max || [];

      targetDates.forEach(date => {
        const row = document.createElement("div");
        row.className = "day-row";

        const idx = times.indexOf(date);

        if (idx !== -1) {
          const code = codes[idx];
          const emoji = weatherCodeToEmoji(code);
          const maxT = Math.round(maxTemps[idx]);
          const minT = Math.round(minTemps[idx]);
          const pop = pops[idx] ?? null;

          const { month, day, weekday } = formatDateParts(date);

          row.innerHTML = `
            <div class="icon">${emoji}</div>
            <div>
              <div>
                <span class="date-label">${month}/${day}</span>
                <span class="weekday">(${weekday})</span>
                <span class="weather-desc">Â· ${weatherCodeToKorean(code)}</span>
              </div>
              <div class="temp-line">
                ìµœì € <span class="temp-min">${minT}Â°</span>
                /
                ìµœê³  <span class="temp-max">${maxT}Â°C</span>
                ${pop !== null ? `<span class="precip">Â· ê°•ìˆ˜í™•ë¥  ${pop}%</span>` : ""}
              </div>
            </div>
          `;
        } else {
          const { month, day, weekday } = formatDateParts(date);
          row.innerHTML = `
            <div class="icon">â”</div>
            <div>
              <div>
                <span class="date-label">${month}/${day}</span>
                <span class="weekday">(${weekday})</span>
              </div>
              <div class="temp-line">ì´ ë‚ ì§œì— ëŒ€í•œ ì˜ˆë³´ ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          `;
        }

        daysDiv.appendChild(row);
      });
    }

    // 5) ë„ì‹œ í•˜ë‚˜ ì²˜ë¦¬
    async function processCity(box) {
      const lat = box.dataset.lat;
      const lon = box.dataset.lon;
      const daysDiv = box.querySelector(".days");
      daysDiv.innerHTML = '<div class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

      try {
        const data = await getDailyForecast(lat, lon);
        if (!data.daily || !data.daily.time) {
          daysDiv.innerHTML = '<div class="error">ì¼ì¼ ì˜ˆë³´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        renderCity(box, data);
      } catch (err) {
        console.error(err);
        daysDiv.innerHTML = '<div class="error">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }

    // 6) í˜ì´ì§€ ë¡œë“œ í›„ ì „ì²´ ë„ì‹œ ì²˜ë¦¬
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".city-box").forEach(processCity);
    });
  </script>
</body>
</html>
